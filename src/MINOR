Å..........*.......*.......*......*.......*.......*.......*.......*.......*.<;list_on_label	LST	ONINSERT_N_RETURNS	; A contains number of returns to insert.	LDX	func_pointer :continue_ins_returns	LDA	#"||"	STA	data_buffer,X	INX	LDA	#"M"	STA	data_buffer,X	INX	DEY	BNE	:continue_ins_returns       	STX	func_pointer	RTSINSERT_FUNC_BUFFER	STX	text_add	STY	text_add+1	LDY	#0	LDX	func_pointer :osy_loop	LDA	(text_add),Y		CMP	#13	BEQ	:do_special_return        CMP	#&FF	BEQ	:end_osy_loop	STA	data_buffer,X	INX	INY	JMP	:osy_loop	:end_osy_loop       	STX	func_pointer	RTS:do_special_return	LDA	#"||"	STA	data_buffer,X	INX	LDA	#"M"	STA	data_buffer,X	INX	INY	JMP	:osy_loopCLEAR_DATA_BUFFER	LDY	#0	TYA:buffer_clear_loop	STA	data_buffer,Y	INY	CPY	#&80	BNE	:buffer_clear_loop	RTSRESTORE        LDA	#229        LDX	#0        LDY	#0        JSR     OSBYTE		; Reset Escape action	LDA	#213	LDX	#101	LDY	#0	JSR	OSBYTE 		; Reset bell frequency	LDA	#214	LDX	#7	LDY	#0	JSR	OSBYTE		; Reset bell duration        LDA	#22        JSR     OSWRCH         LDA	#131		; Exit into MODE 131        JSR     OSWRCH 	JSR	RESET_KEY_RATES	RTSRESET_KEY_RATES	LDA	#196	LDX	value_store	LDY	#0	JSR	OSBYTE	LDA	#197	LDX	value_store+1	LDY	#0	JSR	OSBYTE        RTSSET_KEY_RATES	LDA	#196	LDX	#0	LDY	#0	JSR	OSBYTE	STX	value_store	LDA	#197	LDX	#0	LDY	#0	JSR	OSBYTE	STX	value_store+1	RTSMODE132				LDA	#22	JSR	OSWRCH         LDA	#132        JSR	OSWRCH	JSR	CURSUR_OFF	JSR	DEFINE_CHARACTERS	RTSMODE131				LDA	util_store	CMP	#"D"	BEQ	:skip_mode_change	LDA	#22	JSR	OSWRCH         LDA	#131        JSR	OSWRCH:skip_mode_change	JSR	CURSUR_OFF	JSR	DEFINE_CHARACTERS	RTSCURSUR_OFF        LDA	#23        JSR     OSWRCH         LDA	#1        JSR     OSWRCH         LDA	#0        LDY	#0:cursor_loop        JSR     OSWRCH         INY        CPY	#8        BNE     :cursor_loop	RTSGO_BACKUP_DIRECTORY	LDX	#>up_directory_data	LDY	#<up_directory_data	JSR	MOVE_DOWN_MEMORY	JSR	OSCLI	RTSSTORE_ASCII_VALUE	        LDA     first_num        LDY     num_keys         STA     key_storage,Y         INC     num_keys 	INC	first_num        RTSDIGI_STORE        LDA     key_press         LDY	#0        STA     cont_blk,Y         INY        LDA	#13        STA     cont_blk,Y         RTSMOVE_DIR	STA	Temp        LDA	#"D"         STA     util_com         LDA	#"I"         STA     util_com+1        LDA	#"R"         STA     util_com+2         LDA	#32        STA     util_com+3 	LDA	Temp	CMP	#&FF	BEQ	:not_single_command	STA	util_com+4	LDA	#13	STA	util_com+5	JSR	UTILITY_OSCLI_COMMAND:not_single_command        RTSCHIME_LOOP_1	LDX	oscli_store	LDY	oscli_store+1	LDA	#07	JSR	OSWORD	LDA	#08	CLC	ADC	oscli_store	STA	oscli_store	BCC	:skip_increment	INC	oscli_store+1:skip_increment	LDA	oscli_store	CMP	text_pos	BEQ	:check_hi_byte		JMP	CHIME_LOOP_1:check_hi_byte	LDA	oscli_store+1	CMP	text_pos+1	BNE	CHIME_LOOP_1	RTSCHIME_PART_1	LDX	#>chime_note_1	LDY	#<chime_note_1	STX	oscli_store	STY	oscli_store+1	LDX	#>chime_delay1	LDY	#<chime_delay1	STX	text_pos	STY	text_pos+1	JSR	CHIME_LOOP_1	RTSCHIME_PART_2	LDX	#>chime_delay1	LDY	#<chime_delay1	STX	oscli_store	STY	oscli_store+1	LDX	#>chime_note_24	LDY	#<chime_note_24	STX	text_pos	STY	text_pos+1	JSR	CHIME_LOOP_1	RTSSHOW_ENVIROMENT		LDA	#0	STA	chime_bit	JSR	MODE131	LDX	#>enviro_text	LDY	#<enviro_text        JSR	TOP_HEADER		LDX	#>cfs_text	LDY	#<cfs_text	JSR	PRINT_TEXT	JSR	INVERSE_COLOUR	LDA	curr_file_syst	CMP	#4	BNE	:not_dfs	LDX	#>dfs_data		LDY	#<dfs_data	JSR	PRINT_TEXT	JMP	:not_rfs:not_dfs	CMP	#5	BNE	:not_nfs	LDX	#>nfs_data	LDY	#<nfs_data	JSR	PRINT_TEXT	JMP	:not_rfs:not_nfs	CMP	#8	BNE	:not_adfs	LDX	#>adfs_data		LDY	#<adfs_data	JSR	PRINT_TEXT		JMP	:not_rfs:not_adfs	CMP	#03	BNE	:not_rfs	LDX	#>rfs_data	LDY	#<rfs_data	JSR	PRINT_TEXT:not_rfs	JSR	DEFAULT_COLOUR	LDX	#>csd_text	LDY	#<csd_text	JSR	PRINT_TEXT	JSR	INVERSE_COLOUR	JSR	READ_CSD_NAME	JSR	DEFAULT_COLOUR	LDX	#>drive_text	LDY	#<drive_text	JSR	PRINT_TEXT	JSR	INVERSE_COLOUR	LDA	Temp	CMP	#0	BEQ	:skip_drive	LDA	Temp+1	JSR	OSWRCH	JMP	:skip_non_applic:skip_drive	JSR	PRINT_NA:skip_non_applic	JSR	DEFAULT_COLOUR	LDX	#>fs_text		LDY	#<fs_text	JSR	PRINT_TEXT	LDA	#0	JSR	PRINT_FS_PS_NUMBER	LDX	#>ps_text	LDY	#<ps_text	JSR	PRINT_TEXT	LDA	#2	JSR	PRINT_FS_PS_NUMBER	LDX	#>station_text	LDY	#<station_text	JSR	PRINT_TEXT	JSR	GET_STATION_NUMBER	JSR	INVERSE_COLOUR	LDA	cont_blk+1	JSR	PRINT_NUMBER	JSR	DEFAULT_COLOUR	LDX	#>disc_title_text	LDY	#<disc_title_text	JSR	PRINT_TEXT	JSR	INVERSE_COLOUR	JSR	READ_DISC_TITLE	JSR	DEFAULT_COLOUR	LDX	#>mac_type_text	LDY	#<mac_type_text	JSR	PRINT_TEXT	JSR	INVERSE_COLOUR	LDA	machine_type	STA	Temp	CMP	#2	BPL	:not_bbcB	PHA	LDX	#>mac_BBC_data	LDY	#<mac_BBC_data	JSR	PRINT_TEXT	PLA	CMP	#1	BPL	:not_bbcB_series	LDA	32	JSR	OSWRCH	LDA	#"+"	JSR	OSWRCH:not_bbcB_series	JMP	:end_info:not_bbcB	LDA	Temp	CMP	#3	BNE	:not_128	LDX	#>mac_master_128_data	LDY	#<mac_master_128_data	JSR	PRINT_TEXT	JMP	:end_info:not_128	LDA	Temp        CMP	#4	BNE	:not_ET	LDX	#>mac_ET_data	LDY	#<mac_ET_data		JSR	PRINT_TEXT	JMP	:end_info:not_ET	LDX	#>mac_compact_data	LDY	#<mac_compact_data	JSR	PRINT_TEXT:end_info	JSR	DEFAULT_COLOUR	LDA	#31	JSR	OSWRCH	LDA	#49	JSR	OSWRCH	LDA	#05	JSR	OSWRCH	LDX	#>user_id_text	LDY	#<user_id_text	JSR	PRINT_TEXT	JSR	INVERSE_COLOUR	LDA	curr_file_syst	CMP	#05	BEQ	:do_user_id	JSR	PRINT_NA	JMP	:carry_on_speech:do_user_id	JSR	GET_USER_ID	LDX	#>param_blk	LDY	#<param_blk	JSR	PRINT_TEXT:carry_on_speech	JSR	DEFAULT_COLOUR	LDX	#>speech_status_text	LDY	#<speech_status_text	JSR	PRINT_TEXT	JSR	INVERSE_COLOUR	LDX	#>not_present_data	LDY	#<not_present_data	STX	Temp	STY	Temp+1	LDA	#235	LDX	#0	LDY	#&FF	JSR	OSBYTE	CPX	#&FF	BNE	:speech_not_active	LDA	Temp	CLC	ADC	#4	STA 	Temp:speech_not_active	LDX	Temp	LDY	Temp+1	JSR	PRINT_TEXT	JSR	DEFAULT_COLOUR	LDX	#>tube_status_text	LDY	#<tube_status_text	JSR	PRINT_TEXT	JSR	INVERSE_COLOUR	LDX	#>not_present_data	LDY	#<not_present_data	STX	Temp	STY	Temp+1	LDA	#234	LDX	#0	LDY	#&FF	JSR	OSBYTE	CPX	#&FF	BNE	:tube_not_active	LDA	Temp	CLC	ADC	#4	STA	Temp:tube_not_active	LDX	Temp	LDY	Temp+1	JSR	PRINT_TEXT	JSR	SINGLE_ESCAPE	LDA	#27	STA	key_storage	LDA	#32	STA	key_storage+1	LDA	#2	STA	num_keys:get_new_key	JSR	CHECK_KEYS	LDA	#32	CMP	key_press	BNE	:not_space	JSR	SCREENIN	JMP	:get_new_key:not_space	LDA	#01	STA	chime_bit	RTSSINGLE_ESCAPE	JSR	DEFAULT_COLOUR	JSR	OPT_WINDOW	LDA	#31	JSR	OSWRCH	LDA	#32	JSR	OSWRCH	LDA	#01	JSR	OSWRCH	LDX	#>escape_option_text	LDY	#<escape_option_text	JSR	PRINT_TEXT	RTSSCREENIN	LDA	#80	STA	Temp:out_loop	JSR	VDU1	JSR	VDU2	DEC	Temp	DEC	Temp	LDA	Temp	BPL	:out_loop:screen_in_loop        JSR     DISPLAY_DATE_TIME        LDA	#&81        LDX	#0        LDY	#0        JSR     OSBYTE         CPY	#&FF	BEQ     :screen_in_loop	JSR	SCREENOUT	RTSSCREENOUT	LDA	#0	STA	Temp:in_loop	JSR	VDU1	JSR	VDU2	INC	Temp	INC	Temp	LDA	Temp	CMP	#82	BNE	:in_loop	RTSVDU1	LDA	#23	JSR	OSWRCH	LDA	#0	JSR	OSWRCH	LDA	#1	JSR	OSWRCH	LDA	Temp	JSR	OSWRCH	JSR	ZERO_OSWRCH	RTSVDU2	LDA	#23	JSR	OSWRCH	LDA	#0	JSR	OSWRCH	LDA	#2	JSR	OSWRCH	JSR	WORK_VALUE	LDA	Temp+1	JSR	OSWRCH	JSR	ZERO_OSWRCH	RTSWORK_VALUE	LDA	Temp	STA	Temp+1	LDY	#0:w_v_loop	INY	DEC	Temp+1	DEC	Temp+1	LDA	Temp+1	BNE	:w_v_loop	INY	STY	Temp+1	CLC	LDA	#58	ADC	Temp+1	STA	Temp+1	RTSZERO_OSWRCH        LDA	#0	JSR	OSWRCH	JSR	OSWRCH	JSR	OSWRCH	JSR	OSWRCH	JSR	OSWRCH        JSR     OSWRCH 	RTSSET_KEYS	LDA	curr_file_syst	CMP	#04	BNE	:not_dfs_select_keys	LDX	#>keychoose_dfs        LDY	#<keychoose_dfs	JMP	:pull_down_keys:not_dfs_select_keys	LDX	#>keychoose        LDY	#<keychoose:pull_down_keys        STX     Temp         STY     Temp+1         LDY	#0	LDA	util_store	BEQ	:end_point	LDA	(Temp),Y	STA	key_storage,Y	JMP	:end_set_keys:end_point        LDA     (Temp),Y 	STA	key_storage,Y        CMP	#"$"        BEQ     :end_set_keys        INY        JMP     :end_point:end_set_keys        INY        STY     num_keys         RTSGET_USER_ID	JSR	GET_STATION_NUMBER	; Read local station number	LDA	cont_blk+1		; Get station number returned	STA	cfs_tran		; Save station number for later	LDA	#0	STA	cfs_tran+1	JSR	READ_CURRENT_USER	LDA	#&FF	LDY	cfs_tran+2	STA	param_blk,Y	RTSDEFINE_CHARACTERS	LDY	#&FF:char_def_loop	INY	LDA	USER_CHARACTER_DATA,Y	JSR	OSWRCH	CPY	#69	BNE	:char_def_loop		:exit_char_define	RTSCONVERT_ASC	STA	Temp	LDA	util_store	PHA	LDA	#0	STA 	Temp+1	TAX:digitloop2	LDA	#0	STA	util_store	LDA	Temp	SEC:another2	STA	Temp	INC	util_store	SBC	table,X	BCS	:another2	DEC	util_store	LDA	util_store	BNE	:prntdigit2	LDA	Temp+1	BEQ	:nextdecade2:prntdigit2	LDA	util_store	ORA	#&30	STA	oscli_store	INC	Temp+1:nextdecade2	INX	CPX	#2	BNE	:digitloop2	LDA	Temp	ORA	#&30	STA	oscli_store+1	PLA	STA	util_store	RTSCHECK_HELP_DIRECTORY	LDX	#>help_data	LDY	#<help_data	JSR	MOVE_DOWN_MEMORY	STX	cont_blk	STY	cont_blk+1	LDX	#>cont_blk	LDY	#<cont_blk	LDA	#05	JSR	OSFILE	RTSYES_NO_ESCAPE	LDA	#"Y"	STA	key_storage	LDA	#"N"	STA	key_storage+1	LDA	#27	STA	key_storage+2	LDA	#03	STA	num_keys	JSR	CHECK_KEYS	RTSMOVE_DOWN_MEMORY	STX	Temp	STY	Temp+1	LDY	#0:relocation_loop1	LDA	(Temp),Y	STA	param_blk,Y	INY	CMP	#13	BNE	:relocation_loop1	DEY	STY	cfs_tran+2	LDX	#>param_blk	LDY	#<param_blk	RTSGET_TEXT_POSITION	LDA	#134			; Read text cursur position	LDX	#0		LDY	#0	JSR	OSBYTE	LDA	#31			; Store TAB VDU command	STA	load_address	STX	load_address+1		; Store X pos value	STY	load_address+2 	; Store Y pos value	LDA	#&FF		STA	load_address+3		; Store terminating code	RTSSTART_CLEAR	LDA	#26	JSR	OSWRCH	LDA	#28	JSR	OSWRCH	LDA	#00	JSR	OSWRCH	RTSLEAVE_OBJECT	LDA	Temp+1	PHA			LDA	Temp	PHA	JSR	START_CLEAR	LDA	#24	JSR	OSWRCH	LDA	#79	JSR	OSWRCH	LDA	Temp	CMP	#13	BMI	:skip_decrement	SEC	SBC	#13:skip_decrement	CLC	ADC	#03	JSR	OSWRCH	LDA	#12	JSR	OSWRCH	JSR	START_CLEAR	LDA	Temp	CMP	#13	BMI	:skip_decrement_two	SEC	SBC	#13:skip_decrement_two	CLC	ADC	#01	JSR	OSWRCH	STA	text_pos		; Store Line Number	INC	text_pos		; Inc. as one Line above actual	LDA	#79	JSR	OSWRCH        LDA	#01	JSR	OSWRCH	LDA	#12	JSR	OSWRCH:clear_left_right	LDA	Temp	CMP	#13	BPL	:skip_clear_right	LDX	#>left_clear_window	LDY	#<left_clear_window		JSR	PRINT_TEXT	JMP	:clear_rest:skip_clear_right	LDX	#>right_clear_window	LDY	#<right_clear_window	JSR	PRINT_TEXT:clear_rest	LDA	#0	CMP	util_store	BEQ	:skip_bottom_window	LDX	#>bottom_window_data	LDY	#<bottom_window_data	JSR	PRINT_TEXT	JSR	PRINT_LONG_BAR:skip_bottom_window	LDA	Temp	CMP	#13	BMI	:text_on_left	LDA	#40	STA	text_pos+1	JMP	:finish_determine_pos:text_on_left	LDA	#05		STA	text_pos+1:finish_determine_pos	PLA	STA	Temp	PLA	STA	Temp+1	RTS