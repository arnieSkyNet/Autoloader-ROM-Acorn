SELECT_DISC	JSR	MODE131	LDX	#>select_discs_mode_text	LDY	#<select_discs_mode_text		JSR	TOP_HEADER	LDA	curr_file_syst	CMP	#04	BNE	:not_dfs_fs	JSR	DFS_SELECT		; DFS chosen	CMP	#27	BNE	:dfs_drive_chosen	JMP	:end_disc_select:dfs_drive_chosen	STA	drive_num	LDA	#0	STA	key_press	LDX	#>drive_data	LDY	#<drive_data	JSR	DISC_MOVE_RELOCATE	JMP	:end_disc_select:not_dfs_fs				; NFS chosen	CMP	#05	BNE	:not_nfs_fs	JSR	READ_DISPLAY_NET_DISCS	LDA	#01	STA	chime_bit	JSR	CHECK_KEYS	CMP	#27	BEQ	:escape_move_net_disc	JSR	MOVE_TO_NET_DISC:escape_move_net_disc	JMP	:end_disc_select:not_nfs_fs				; ADFS chosen	JSR	ADFS_SELECT	CMP	#27	BNE	:mount_ok	JMP	:end_disc_select:mount_ok	STA	drive_num	LDA	#0	STA	key_press	LDX	#>mount_data	LDY	#<mount_data	JSR	DISC_MOVE_RELOCATE	LDX	#>adfs_lib_data	LDY	#<adfs_lib_data	STX	oscli_store	STY	oscli_store+1	LDA	#&FE	JSR	ERROR_OSCLI:end_disc_select	RTSDISC_MOVE_RELOCATE	PHA	STX	oscli_store	STY	oscli_store+1	LDY	#0	JSR	OSNEWL	LDA	#11:mount_relocate	JSR	OSWRCH	LDA	(oscli_store),Y	STA	util_com,Y	INY	CMP	#13	BNE	:mount_relocate	DEY	PLA				; address drive_num + keypress	TAX      	LDA	drive_num,X		; contains the drive number to	STA	util_com,Y		; switch to.	JSR	OSWRCH	JSR	OSNEWL	INY	LDA	#13	STA	util_com,Y	JSR	UTILITY_OSCLI_COMMAND	RTSSTORE_DISC_KEYS	LDA	#"0"	STA	key_storage	LDA	#"1"	STA	key_storage+1	LDA	#27	STA	key_storage+2	LDA	#"2"	STA	key_storage+3	LDA	#"3"	STA	key_storage+4	RTSDFS_SELECT	LDX	#>dfs_disc_menu_text	LDY	#<dfs_disc_menu_text	JSR	PRINT_TEXT	JSR	SINGLE_ESCAPE	JSR	STORE_DISC_KEYS	LDA	#5	STA	num_keys	JSR	CHECK_KEYS	RTSADFS_SELECT	LDX	#>adfs_mount_discs_text	LDY	#<adfs_mount_discs_text	JSR	PRINT_TEXT	JSR	SINGLE_ESCAPE	JSR	STORE_DISC_KEYS	LDA	#3	STA	num_keys	JSR	CHECK_KEYS	RTSREAD_DISPLAY_NET_DISCS	LDA	#31	JSR	OSWRCH	LDA	#0	JSR	OSWRCH	LDA	#01	JSR	OSWRCH	LDA	#0	STA	file_num	LDA	#1	STA	num_keys	LDA	#27	STA	key_storage:disc_loop	JSR	READ_NEXT_DISC	LDA	cont_blk+4	BEQ	:no_more_discs	LDA	file_num	CLC	ADC	#65	JSR	OSWRCH	LDY	file_num	STA	key_storage+1,Y	LDA	#")"	JSR	OSWRCH	LDA	#32	JSR	OSWRCH	LDY	#5:print_disc_title_loop	INY	LDA	cont_blk,Y	CMP	#32		BEQ	:end_disc_title	CPY	#22	BEQ	:end_disc_title	JSR	OSWRCH	JMP	:print_disc_title_loop:end_disc_title	INC	file_num	JSR	OSNEWL	JMP	:disc_loop:no_more_discs	LDY	file_num	INY	STY	num_keys	LDA	machine_type	CMP	#03	BMI	:skip_tape_check	JSR	BACKUP_TAPE:skip_tape_check	JSR	SINGLE_ESCAPE	RTSBACKUP_TAPE	JSR	SET_TIMEOUTS	JSR	READ_TAPE_ID	BCC	:no_tape	INC	file_num	LDA	#31	JSR	OSWRCH	LDA	#40	JSR	OSWRCH	LDA	#01	JSR	OSWRCH	JSR	INVERSE_COLOUR	LDA	file_num	CLC	ADC	#65	STA	cfs_tran	JSR	OSWRCH	LDA	#")"	JSR	OSWRCH	LDA	#32	JSR	OSWRCH	LDX	#>object_name	LDY	#<object_name	JSR	PRINT_TEXT	JSR	DEFAULT_COLOUR	LDA	#31	JSR	OSWRCH	LDA	#55	JSR	OSWRCH	LDA	#01	JSR	OSWRCH	LDX	#>tape_text	LDY	#<tape_text	JSR	PRINT_TEXT	LDA	cfs_tran	LDY	file_num	STA	key_storage,Y	INC	num_keys:no_tape	JSR	RESET_TIMEOUTS	RTSSET_TIMEOUTS	LDA	#&FF	CMP	tape_flag	BNE	:not_tape_already	JMP	:timeouts_already_set:not_tape_already       LDA	#15		; Read timeouts	STA	cont_blk	LDX	#>cont_blk	LDY	#<cont_blk	LDA	#&13			JSR	OSWORD	LDA	cont_blk+1	STA	timeout_store	LDA	cont_blk+2	STA	timeout_store+1		LDA	cont_blk+3	STA	timeout_store+2	LDA	#16		; Set new timeouts	STA	cont_blk	LDA	#&FF	STA	cont_blk+1	STA	cont_blk+2	STA	cont_blk+3	LDX	#>cont_blk	LDY	#<cont_blk	LDA	#&13			JSR	OSWORD:timeouts_already_set	LDA	#&FF	STA	tape_flag	RTSRESET_TIMEOUTS	LDA	#16		; Set timeouts	STA	cont_blk	LDA	timeout_store	STA	cont_blk+1	LDA	timeout_store+1	STA	cont_blk+2	LDA	timeout_store+2	STA	cont_blk+3	LDX	#>cont_blk	LDY	#<cont_blk	LDA	#&13			JSR	OSWORD	LDA	#0	STA	tape_flag	RTSREAD_NEXT_DISC	JSR	CLEAR_CONTROL_BLOCK	LDA	#9	STA	cont_blk+1	LDA	#14	STA	cont_blk+3	LDX	file_num	STX	cont_blk+7	INX		STX	cont_blk+8	LDX	#>cont_blk	LDY	#<cont_blk	LDA	#&14	JSR	OSWORD	RTSCLEAR_CONTROL_BLOCK	LDY	#0	TYA:clr_block_loop	STA	cont_blk,Y	INY	CPY	#18	BNE	:clr_block_loop	RTSREAD_TAPE_ID	JSR	CLEAR_CONTROL_BLOCK	LDA	#12		; Size of control block	STA	cont_blk+1	LDA	#67		; Func code 67 Read/Write Backup	STA	cont_blk+3	LDA	#1		; ARG = 1	STA	cont_blk+7	LDA	#12		; Load offset value (12)	STA	cont_blk+8	; Get Tape Name	LDA	#12		; Load 12 bytes	STA	cont_blk+10	; Get 12 bytes if data only	LDX	#>cont_blk	LDY	#<cont_blk	LDA	#&14		; OSWORD number &14	JSR	OSWORD	LDA	cont_blk+3	BEQ	:no_osword_err	CLC	RTS	BRK	BRK	BRK:no_osword_err	SEC	LDX	#>cont_blk	LDY	#<cont_blk	STX	Temp	STY	Temp+1	LDY	#04	LDX	#0:tape_name_move	LDA	(Temp),Y	CMP	#13	BEQ	:end_tape_name	CMP	#0	BEQ	:end_tape_name	CMP	#126	BPL	:end_tape_name	STA	object_name,X	INX	INY	CPX	#10	BEQ	:end_tape_name	JMP	:tape_name_move:end_tape_name	LDA	#&FF	STA	object_name,X	RTSMOVE_TO_NET_DISC	SEC	SBC	#65	STA	file_num	LDY	num_keys	DEY	STY	key_press	CMP	key_press	BEQ	:tape_chosen	JSR	READ_NEXT_DISC	LDY	#05	LDX	#0	LDA	#"$"	STA	object_name,X	INX:do_disc_title_loop	INY	LDA	cont_blk,Y	CMP	#32		BEQ	:end_do_title	CPY	#22	BEQ	:end_do_title	STA	object_name,X	INX	JMP	:do_disc_title_loop:end_do_title	LDA	#13	STA	object_name,X	LDA	#"D" 	STA     util_com 	LDA	#"I" 	STA     util_com+1	LDA	#"R" 	STA     util_com+2 	LDA	#32	STA     util_com+3 	JSR	UTILITY_OSCLI_COMMAND	RTS:tape_chosen	JSR	SET_TIMEOUTS	LDX	#>tape_data	LDY	#<tape_data	JSR	MOVE_DOWN_MEMORY	STX	oscli_store	STY	oscli_store+1	LDA	#&FE	JSR	ERROR_OSCLI	RTS