Å..........*.......*.......*......*..........*....*.......*.......*.......*.<; This is the main subroutine that displays options and objectsDISPLAY_OBJECTS_OPTIONS	LDA	file_num		; Get next file number to read	PHA				; Stack file number for later	LDA	#0			; Set A = 0 (file_num)        STA     file_num 		; Save 0 to file_num	LDA	util_store		; A = util_store value	BNE	:skip_return_flag_reset	; 	STA	more_ret:skip_return_flag_reset        JSR     READ_OBJECT 		; Read object (file_num)        CMP	#01			; Check for more files        BNE     :main_reset_start	; to read.        JSR     NO_OBJECTS 		; No objects ro read	PLA				; Restore stack position	RTS:main_reset_start	PLA				; Unstack object number to read	STA	file_num		; Save value in file_num:main_reset	JSR	DEFAULT_COLOUR		; Make sure not shaded print        JSR     SET_KEYS         LDX	#>main_window_data	; Clear main object window        LDY	#<main_window_data	; for printing of objects	LDA	util_store	CMP	#"D"	BNE	:define_object_window	JSR	READ_CURRENT_MODE	CPY	#0	BEQ	:mode128_wind_data	CPY	#128	BEQ	:mode128_wind_data        LDX	#>main_window_data	; Clear main object window        LDY	#<main_window_data	; for printing of objects	JMP	:define_object_window:mode128_wind_data	LDX	#>alt_obj_wind		; Clear main object window	LDY	#<alt_obj_wind		; for printing of objects:define_object_window        JSR     PRINT_TEXT         LDA	#31			; Position cursur to print        JSR     OSWRCH         LDA	#06			; Position at indent 6         STA     text_pos 		; Save indent postion        JSR     OSWRCH        LDA	#01			; Postion at line 1	STA     text_pos+1 		; Save line position        JSR     OSWRCH 	LDA	#"A"			; Character A first to print	STA	first_num:repeat_loop	LDA	file_num		; Next file number to read	STA	last_file_num		; Save this value        JSR     READ_OBJECT 		; Do read objects routine        BEQ     :object_returned	; If A = 0 then object to print        LDA	#0			; Reset file_num = 0 in A        STA     file_num 		; Save A to file_num        JMP     :all_screen_data:object_returned        JSR     PRINT_OBJECT 		; Print object returned	LDA	first_num		        CMP     #"["			; Check first_num > 26	BEQ	:set_return_flag	; then set return flag        JMP     :repeat_loop		; If not then do all again:set_return_flag	LDA	file_num		; Get next file to read	STA	first_num		; Store value in first_num	JSR	READ_OBJECT		; Read next object	PHA				; Stack cont_blk+5 value	LDA	first_num		; Get old file_num value	STA	file_num		; Save back into file_num	PLA				; A = cont_blk+5	BNE	:all_screen_data	; If not 0 then no more files        LDA	#13			; Must be more files for next        STA     more_ret 		; page. Set return flag:all_screen_data        JSR     OPT_WINDOW		; Clear options window        JSR     DISPLAY_RET_ESC_DEL_OPTION	; Print options in window:redue_keys	JSR	CHECK_KEYS		; User selects his choice	LDA	key_press		; Get chosen selection        CMP	#13			; Check if return chosen        BEQ     :return_pressed	; If return chosen JMP	RTS				;Exit if object/utility chosen:return_pressed	INC	screen_num		; Increment screen/page number	LDA	file_num		; Get next file number to read	BNE	:not_reset_page_number	; More files to read=more pages	STA	screen_num		; No files = reset page number:not_reset_page_number        JMP     :main_resetUTILITY_HEADER	LDA	#26	JSR	OSWRCH	JSR	PRINT_LONG_BAR		JSR	INVERSE_COLOUR	LDA	util_store	CMP	#"2"	BEQ	:transfer_head	CMP	#"3"	BEQ	:rename_head	CMP	#135	BEQ	:copy_head	CMP	#127	BEQ	:delete_head	CMP	#"/"	BEQ	:help_head	CMP	#"?"	BEQ	:help_head:help_head	LDX	#>help_mode_heading_text	LDY	#<help_mode_heading_text	JMP	:do_utility_heading:delete_head        LDX	#>delete_mode_text        LDY	#<delete_mode_text	JMP	:do_utility_heading:transfer_head	LDX	#>media_transfer_mode_text	LDY	#<media_transfer_mode_text	JMP	:do_utility_heading:copy_head        LDX	#>copyfile_mode_text         LDY	#<copyfile_mode_text	JMP	:do_utility_heading:rename_head        LDX	#>rename_mode_text        LDY	#<rename_mode_text	JMP	:do_utility_heading:do_utility_heading	JSR	PRINT_TEXT	JSR	DEFAULT_COLOUR	JSR	RESET_PAGE_OBJECT_NUMBERS	RTSRESET_PAGE_OBJECT_NUMBERS	LDA	screen_num	CMP	#0	BEQ	:exit_reset_page_object_numbers	STA	oscli_store		; Save current screen number	LDA	#0			; Clear work areas	STA	Temp	STA	Temp+1	JSR	SCREEN_LOOP		; Calculate file number	PHA				; Stack calculated file number	LDA	oscli_store		; Load old screen number	STA	screen_num		; and restore.	PLA				; Unstack new file number:exit_reset_page_object_numbers	STA	file_num	RTSSCREEN_LOOP        LDA     screen_num         CMP	#0        BEQ     :object_screen_number_calculated        LDA	#26	CLC	ADC	Temp+1	STA     Temp+1         DEC     screen_num         JMP     SCREEN_LOOP:object_screen_number_calculated        LDA     Temp         CLC        ADC     Temp+1 	STA     file_num 	RTSGET_OBJECT_CHOSEN        LDA	#0        STA     Temp+1 	LDA	key_press        SEC        SBC	#65        STA     Temp	JSR	LEAVE_OBJECT	LDA	curr_file_syst	CMP	#04	BNE	:not_dfs_skip_dfs_fudge	INC	text_pos+1	LDA	#26	JSR	OSWRCH			; Reset default window (MAIN)	LDA	#31			; VDU Print at value	JSR	OSWRCH	LDA	text_pos+1		; Print at TAB pos	JSR	OSWRCH	LDA	text_pos		; Print at line number	JSR	OSWRCH			; Under Letter selected	LDY	#0:find_start_obj_name_loop	JSR	GET_CHARACTER_AT_TEXT	CMP	#" "	BEQ	:got_obj_start	LDA	#09			; Move Text forward 1	JSR	OSWRCH	JMP	:find_start_obj_name_loop:got_obj_start	LDA	#09			; Move Text forward 1	JSR	OSWRCH        LDY	#01:read_get_obj_name_lp	TYA	PHA	JSR	GET_CHARACTER_AT_TEXT	STA	Temp		PLA	TAY	LDA	Temp	STA	param_blk,Y	INY	PHA	LDA	#09	JSR	OSWRCH	PLA	CMP	#32	BNE	:read_get_obj_name_lp	DEY	LDA	#13  	STA	param_blk,Y	RTS:not_dfs_skip_dfs_fudge	JSR	SCREEN_LOOP		; calculate file chosen        JSR     READ_OBJECT	RTSGET_CHARACTER_AT_TEXT	LDA	#&87	JSR	OSBYTE	TXA	RTS